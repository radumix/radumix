
What is Kafka?

Kafka is built around a few core ideas:

1. Topics
Logical channels where messages (“events”) are stored.
2. Producers
Applications that write messages to topics.
3. Consumers
Applications that read messages from topics.
4. Brokers
Kafka servers that store and distribute events.
5. Partitions
Each topic is split into partitions for parallelism and scalability.
6. Consumer Groups
Allow multiple consumers to share the work.
-------------------
in .NET
Confluent.Kafka
NuGet: Confluent.Kafka
dotnet add package Confluent.Kafka
Create a Producer and Consumer
"Kafka": {
    "BootstrapServers": "kafka.company.com:9092",
    "Topic": "test-topic",
    "GroupId": "sample-consumer-group"
  }

using Confluent.Kafka;

public class KafkaProducerService : IKafkaProducerService
{
    private readonly IProducer<string, string> _producer;
    private readonly string _topic;

    public KafkaProducerService(
        IProducer<string, string> producer,
        IConfiguration config)
    {
        _producer = producer;
        _topic = config["Kafka:Topic"]!;
    }

    public async Task SendAsync(string message)
    {
        await _producer.ProduceAsync(
            _topic,
            new Message<string, string> { Value = message }
        );
    }
}
using Confluent.Kafka;

public class KafkaConsumerService : BackgroundService
{
    private readonly IConfiguration _config;
    private readonly ILogger<KafkaConsumerService> _logger;
    private readonly IConsumer<string, string> _consumer;
    private readonly string _topic;

    public KafkaConsumerService(
        IConfiguration config,
        ILogger<KafkaConsumerService> logger)
    {
        _config = config;
        _logger = logger;

        var consumerConfig = new ConsumerConfig
        {
            BootstrapServers = _config["Kafka:BootstrapServers"],
            GroupId = _config["Kafka:GroupId"],
            AutoOffsetReset = AutoOffsetReset.Earliest,
            EnableAutoCommit = true
        };

        _topic = _config["Kafka:Topic"]!;
        _consumer = new ConsumerBuilder<string, string>(consumerConfig).Build();
        _consumer.Subscribe(_topic);
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        _logger.LogInformation("Kafka consumer started...");

        while (!stoppingToken.IsCancellationRequested)
        {
            try
            {
                var message = _consumer.Consume(stoppingToken);
                _logger.LogInformation($"[Kafka] Received message: {message.Message.Value}");
            }
            catch (ConsumeException ex)
            {
                _logger.LogError($"Kafka error: {ex.Error.Reason}");
            }
        }

        _consumer.Close();
    }
}
----
using Confluent.Kafka;
using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;

var builder = WebApplication.CreateBuilder(args);

// Load Kafka settings
var kafkaBootstrap = builder.Configuration["Kafka:BootstrapServers"];

// -----------------------
// Register Kafka Producer
// -----------------------
builder.Services.AddSingleton(new ProducerConfig
{
    BootstrapServers = kafkaBootstrap
});

builder.Services.AddSingleton<IProducer<string, string>>(sp =>
{
    var config = sp.GetRequiredService<ProducerConfig>();
    return new ProducerBuilder<string, string>(config).Build();
});

builder.Services.AddScoped<IKafkaProducerService, KafkaProducerService>();

// -----------------------
// Register Consumer Service
// -----------------------
builder.Services.AddHostedService<KafkaConsumerService>();

// Create the app
var app = builder.Build();

// Endpoint to send a Kafka message
app.MapGet("/send/{msg}", async (string msg, IKafkaProducerService kafka) =>
{
    await kafka.SendAsync(msg);
    return $"Message sent: {msg}";
});

app.MapGet("/", () => "Kafka Producer + Consumer is running!");

app.Run();
